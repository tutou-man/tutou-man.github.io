function getRankInfo(i,e){var t=Number.MAX_VALUE;i.stirfry>0&&(t=Math.min(t,e.stirfryVal/i.stirfry)),i.boil>0&&(t=Math.min(t,e.boilVal/i.boil)),i.knife>0&&(t=Math.min(t,e.knifeVal/i.knife)),i.fry>0&&(t=Math.min(t,e.fryVal/i.fry)),i.bake>0&&(t=Math.min(t,e.bakeVal/i.bake)),i.steam>0&&(t=Math.min(t,e.steamVal/i.steam));var a={},r=0,n="-",o=0;return t!=Number.MAX_VALUE&&(t>=5?(r=100,n="传",o=5):t>=4?(r=50,n="神",o=4):t>=3?(r=30,n="特",o=3):t>=2?(r=10,n="优",o=2):t>=1&&(r=0,n="可",o=1)),a.rankAddition=r,a.rankDisp=n,a.rankVal=o,a}function getRecipeAddition(i,e,t,a,r,n){var o=0,s=0;for(var f in i){var l=i[f],c=checkSkillCondition(l,e,t,a,r);c.pass&&(isRecipePriceAddition(l,a,n)&&(o+=l.value*c.count),isRecipeBasicAddition(l)&&(s+=l.value*c.count))}var d={};return d.price=o,d.basic=s,d}function isRecipePriceAddition(i,e,t){var a=i.type,r=!1;if("UseAll"==a)e.rarity==i.rarity&&(r=!0);else if("UseFish"==a){for(var n in e.materials)if("池塘"==e.materials[n].origin){r=!0;break}}else if("UseCreation"==a){for(var n in e.materials)if("作坊"==e.materials[n].origin){r=!0;break}}else if("UseMeat"==a){for(var n in e.materials)if("牧场"==e.materials[n].origin||"鸡舍"==e.materials[n].origin||"猪圈"==e.materials[n].origin){r=!0;break}}else if("UseVegetable"==a){for(var n in e.materials)if("菜棚"==e.materials[n].origin||"菜地"==e.materials[n].origin||"森林"==e.materials[n].origin){r=!0;break}}else"UseStirfry"==a?e.stirfry>0&&(r=!0):"UseBoil"==a?e.boil>0&&(r=!0):"UseFry"==a?e.fry>0&&(r=!0):"UseKnife"==a?e.knife>0&&(r=!0):"UseBake"==a?e.bake>0&&(r=!0):"UseSteam"==a?e.steam>0&&(r=!0):"UseSweet"==a?"Sweet"==e.condiment&&(r=!0):"UseSour"==a?"Sour"==e.condiment&&(r=!0):"UseSpicy"==a?"Spicy"==e.condiment&&(r=!0):"UseSalty"==a?"Salty"==e.condiment&&(r=!0):"UseBitter"==a?"Bitter"==e.condiment&&(r=!0):"UseTasty"==a?"Tasty"==e.condiment&&(r=!0):"Gold_Gain"==a?t&&0!=t.Id&&!t.Satiety||(r=!0):"CookbookPrice"==a&&(r=!0);return!!r}function isRecipeBasicAddition(i){return"BasicPrice"==i.type}function getMaterialsAddition(i,e){var t=0;for(var a in i.materials)for(var r in e)if(i.materials[a].material==e[r].materialId&&e[r].addition){t+=Number(e[r].addition);break}return+t.toFixed(2)}function buildRecipeMenu(i){var e=[],t={};return t.data=i,e.push(t),e}function getPercentDisp(i){return 0!=i?i.toString()+"%":""}function getAbsDisp(i){return 0==i?"":i.toString()}function getRecipeQuantity(i,e,t){var a=1;for(var r in t.hasOwnProperty("DisableMultiCookbook")&&0!=t.DisableMultiCookbook||(a=i.limitVal),i.materials){var n=!1;for(var o in e)if(i.materials[r].material==e[o].materialId){if(n=!0,e[o].quantity){var s=Math.floor(e[o].quantity/i.materials[r].quantity);s<a&&(a=s);break}if(0===e[o].quantity)return 0}if(!n)return 0}return a<0?0:a}function getRecipeResult(i,e,t,a,r,n,o,s,f,l,c,d,u){var p={},b=0,v=0,m=0,y=0,k=0,A=0,h=new Addition,D=0;if(i&&i.chefId){var g=getRankInfo(t,i);if(p.rankVal=g.rankVal,p.rankDisp=g.rankDisp,!l&&0==g.rankVal)return p;if(o&&o.hasOwnProperty("DisableCookbookRank")&&0!=o.DisableCookbookRank||(b=g.rankAddition),p.rankAdditionDisp=getPercentDisp(b),!o||!o.hasOwnProperty("DisableChefSkillEffect")||0==o.DisableChefSkillEffect){var S=getRecipeAddition(i.specialSkillEffect,i,c,t,a,o);v+=S.price,h.percent+=S.basic;var V=getRecipeAddition(i.selfUltimateEffect,i,c,t,a,o);if(v+=V.price,h.percent+=V.basic,d)for(var P in d){var M=d[P].effect;isRecipePriceAddition(M,t,o)&&(D+=M.value*d[P].count),isRecipeBasicAddition(M)&&(h.percent+=M.value*d[P].count)}}if(p.chefSkillAdditionDisp=getPercentDisp(v),(!o||!o.hasOwnProperty("DisableEquipSkillEffect")||0==o.DisableEquipSkillEffect)&&e&&e.effect){var C=updateEquipmentEffect(e.effect,i.selfUltimateEffect),E=getRecipeAddition(C,i,c,t,a,o);m=E.price,h.percent+=E.basic}p.equipSkillAdditionDisp=getPercentDisp(m),k+=Number(i.addition)}if(p.satiety=t.rarity,u){var I=0;for(var P in u){var w=u[P].effectType,R=u[P].effectValue;"IntentAdd"==w&&(I+=R)}var N=new Addition,T=0,U=new Addition;for(var P in u){var x=u[P].buffId;w=u[P].effectType,R=u[P].effectValue;"BasicPriceChange"==w?(x||(R*=1+.01*I),N.abs+=R):"BasicPriceChangePercent"==w?(x||(R*=1+.01*I),N.percent+=R):"SatietyChange"==w?(x||(R*=1+.01*I),U.abs+=R):"SatietyChangePercent"==w?(x||(R*=1+.01*I),U.percent+=R):"SetSatietyValue"==w?p.satiety=R:"PriceChangePercent"==w&&(x||(R*=1+.01*I),T+=R)}h.abs+=N.abs,h.percent+=N.percent,k+=T/100,p.satiety=Math.ceil(calAddition(p.satiety,U))}if(p.partialAdditionDisp=getPercentDisp(D),p.basicPercentDisp=getPercentDisp(h.percent),p.basicAbsDisp=getAbsDisp(h.abs),(!o||!o.hasOwnProperty("DisableCondimentEffect")||0==o.DisableCondimentEffect)&&f){p.useCondiment=!0;var q=getRecipeAddition(f.effect,i,c,t,a,o);A=q.price}if(p.condimentSkillAdditionDisp=getPercentDisp(A),o&&o.hasOwnProperty("DisableDecorationEffect")&&0!=o.DisableDecorationEffect||s&&(y=s),p.decorationAdditionDisp=getPercentDisp(y),k+=Number(t.addition),o&&o.hasOwnProperty("MaterialsEffect")){var O=getMaterialsAddition(t,n);k+=O}var B=(b+v+m+A+y+t.ultimateAddition+D)/100,F=calAddition(t.price,h);u||(F=Math.floor(F)),p.data=t,p.quantity=a,p.max=r,p.limit=a,p.bonusAdditionDisp=getPercentDisp(+(100*k).toFixed(2)),p.totalPrice=t.price*a,p.realPrice=Math.ceil(+(F*(1+B)).toFixed(2));var L=Math.ceil(+(F*(1+B+k)).toFixed(2));p.bonusScore=L-p.realPrice,p.totalBonusScore=p.bonusScore*a,p.score=L,p.totalScore=L*a,p.totalTime=t.time*a,p.totalTimeDisp=secondsToTime(p.totalTime);var J=Math.floor(3600*p.realPrice/t.time);p.efficiency=J;var K=0;return i&&p.rankVal>0&&(K=J),p.chefEff=K,p}function calAddition(i,e){return+((i+e.abs)*(1+e.percent/100)).toFixed(2)}function getTimeAddition(i){var e=0;for(var t in i)"OpenTime"==i[t].type&&(e+=i[t].value);return+e.toFixed(2)}function updateEquipmentEffect(i,e){var t=i;for(var a in e)if("MutiEquipmentSkill"==e[a].type)for(var r in t=JSON.parse(JSON.stringify(i)),t){var n=new Addition;setAddition(n,e[a]),t[r].value=calAddition(t[r].value,n)}return t}function setAddition(i,e){"Abs"==e.cal?i.abs=+(i.abs+e.value).toFixed(2):"Percent"==e.cal&&(i.percent=+(i.percent+e.value).toFixed(2))}function Addition(){this.abs=0,this.percent=0}function secondsToTime(i){i=Number(i);var e=Math.floor(i/3600/24),t=Math.floor(i/3600%24),a=Math.floor(i/60%60),r=Math.floor(i%60),n="";return e>0&&(n+=e+"天"),t>0&&(n+=t+"小时"),a>0&&(n+=a+"分"),r>0&&(n+=r+"秒"),n}function getEquipInfo(i,e){var t=null;if(i)for(var a in e)if(i==e[a].equipId)return e[a];return t}function getCondimentInfo(i,e){var t=null;if(i)for(var a in e)if(i==e[a].condimentId)return e[a];return t}function setDataForChef(i,e,t,a,r,n,o,s,f){var l=new Addition,c=new Addition,d=new Addition,u=new Addition,p=new Addition,b=new Addition,v=0,m=0,y=0,k=0,A=new Addition,h=new Addition,D=new Addition,g=new Addition,S=new Addition,V=new Addition,P=[];if(i.selfUltimateEffect=[],!f||!f.hasOwnProperty("DisableChefSkillEffect")||0==f.DisableChefSkillEffect){if(P=P.concat(i.specialSkillEffect),P=P.concat(a),n)for(var M in n)if(i.chefId==n[M].chefId){i.selfUltimateEffect=n[M].effect,P=P.concat(n[M].effect);break}if(r)for(var M in r)P=P.concat(r[M])}if((!f||!f.hasOwnProperty("DisableEquipSkillEffect")||0==f.DisableEquipSkillEffect)&&t&&e&&e.effect){var C=updateEquipmentEffect(e.effect,i.selfUltimateEffect);P=P.concat(C)}for(var M in o&&(P=P.concat(o)),P){var E=P[M].type,I=P[M].tag;I&&i.tags.indexOf(I)<0||("Stirfry"==E?setAddition(l,P[M]):"Boil"==E?setAddition(c,P[M]):"Knife"==E?setAddition(d,P[M]):"Fry"==E?setAddition(u,P[M]):"Bake"==E?setAddition(p,P[M]):"Steam"==E?setAddition(b,P[M]):"Meat"==E?v+=P[M].value:"Creation"==E?m+=P[M].value:"Vegetable"==E?y+=P[M].value:"Fish"==E?k+=P[M].value:"Sweet"==E?setAddition(A,P[M]):"Sour"==E?setAddition(h,P[M]):"Spicy"==E?setAddition(D,P[M]):"Salty"==E?setAddition(g,P[M]):"Bitter"==E?setAddition(S,P[M]):"Tasty"==E&&setAddition(V,P[M]))}i.meatVal=i.meat+v,i.creationVal=i.creation+m,i.vegVal=i.veg+y,i.fishVal=i.fish+k,i.meatDisp=getAtrributeDisp(i.meatVal,i.meat,s),i.creationDisp=getAtrributeDisp(i.creationVal,i.creation,s),i.vegDisp=getAtrributeDisp(i.vegVal,i.veg,s),i.fishDisp=getAtrributeDisp(i.fishVal,i.fish,s),i.stirfryVal=Math.ceil(calAddition(i.stirfry,l)),i.boilVal=Math.ceil(calAddition(i.boil,c)),i.knifeVal=Math.ceil(calAddition(i.knife,d)),i.fryVal=Math.ceil(calAddition(i.fry,u)),i.bakeVal=Math.ceil(calAddition(i.bake,p)),i.steamVal=Math.ceil(calAddition(i.steam,b)),i.stirfryDisp=getAtrributeDisp(i.stirfryVal,i.stirfry,s),i.boilDisp=getAtrributeDisp(i.boilVal,i.boil,s),i.knifeDisp=getAtrributeDisp(i.knifeVal,i.knife,s),i.fryDisp=getAtrributeDisp(i.fryVal,i.fry,s),i.bakeDisp=getAtrributeDisp(i.bakeVal,i.bake,s),i.steamDisp=getAtrributeDisp(i.steamVal,i.steam,s),i.sweetVal=Math.ceil(calAddition(i.sweet,A)),i.sourVal=Math.ceil(calAddition(i.sour,h)),i.spicyVal=Math.ceil(calAddition(i.spicy,D)),i.saltyVal=Math.ceil(calAddition(i.salty,g)),i.bitterVal=Math.ceil(calAddition(i.bitter,S)),i.tastyVal=Math.ceil(calAddition(i.tasty,V)),i.sweetDisp=getAtrributeDisp(i.sweetVal,i.sweet,s),i.sourDisp=getAtrributeDisp(i.sourVal,i.sour,s),i.spicyDisp=getAtrributeDisp(i.spicyVal,i.spicy,s),i.saltyDisp=getAtrributeDisp(i.saltyVal,i.salty,s),i.bitterDisp=getAtrributeDisp(i.bitterVal,i.bitter,s),i.tastyDisp=getAtrributeDisp(i.tastyVal,i.tasty,s),i.disp="<span class='name'>"+i.name+"</span><br><small>";var w=0;i.stirfryDisp&&(i.disp+="炒"+i.stirfryDisp+" ",w++),i.boilDisp&&(i.disp+="煮"+i.boilDisp+" ",w++,w%2==0&&(i.disp+="<br>")),i.knifeDisp&&(i.disp+="切"+i.knifeDisp+" ",w++,w%2==0&&(i.disp+="<br>")),i.fryDisp&&(i.disp+="炸"+i.fryDisp+" ",w++,w%2==0&&(i.disp+="<br>")),i.bakeDisp&&(i.disp+="烤"+i.bakeDisp+" ",w++,w%2==0&&(i.disp+="<br>")),i.steamDisp&&(i.disp+="蒸"+i.steamDisp+" "),i.disp+="</small>"}function getAtrributeDisp(i,e,t){var a="";if(t)return i&&(a=i),a;e&&(a+=e);var r=i-e;return r&&(r>0&&(a+="+"),a+=r),a}function getRarityDisp(i){for(var e="",t=0;t<i;t++)e+="&#x2605;";return e}function isNumeric(i){return!isNaN(parseFloat(i))&&isFinite(i)}function isChefAddType(i){return"Stirfry"==i||"Boil"==i||"Knife"==i||"Fry"==i||"Bake"==i||"Steam"==i}function getPartialRecipeAdds(i,e,t){for(var a=[],r=0;r<3;r++)a.push([]);for(var n in i){var o=i[n].chef;if(o.chefId&&t.calPartialChefIds.indexOf(o.chefId)>=0)for(var s in e){var f=e[s];if(o.ultimateSkill==f.skillId){var l=i[n].recipes;for(var c in f.effect){var d=f.effect[c];if("Partial"==d.condition){var u=checkSkillCondition(d,o,l,null,null);if(u.pass){var p={};p.effect=d,p.count=u.count;var b=0;t.Satiety&&(b=Number(n));for(r=b;r<3;r++)a[r].push(p)}}else if("Next"==d.condition&&Number(n)<2){u=checkSkillCondition(d,o,l,null,null);if(u.pass){p={};p.effect=d,p.count=u.count,a[Number(n)+1].push(p)}}}break}}}return a}function checkSkillCondition(i,e,t,a,r){var n={pass:!0,count:1};if(!i.conditionType)return n;if("Rank"==i.conditionType){if(a){var o=getRankInfo(a,e);if(o.rankVal>=i.conditionValue)return n}}else if("PerRank"==i.conditionType){var s=0;for(var f in t){var l=t[f];if(l.data){o=getRankInfo(l.data,e);o.rankVal>=i.conditionValue&&s++}}if(s>0)return n.count=s,n}else if("ExcessCookbookNum"==i.conditionType){if(a&&r>=i.conditionValue)return n}else if("CookbookRarity"==i.conditionType){if(a&&i.conditionValueList.indexOf(a.rarity)>=0)return n}else if("SameSkill"==i.conditionType){var c=0,d=0,u=0,p=0,b=0,v=0,m=0;for(var f in t){l=t[f].data;l&&(l.stirfry>0&&(d++,3==d&&c++),l.boil>0&&(u++,3==u&&c++),l.knife>0&&(p++,3==p&&c++),l.fry>0&&(b++,3==b&&c++),l.bake>0&&(v++,3==v&&c++),l.steam>0&&(m++,3==m&&c++))}if(c>0)return n.count=c,n}else console.log("unknown conditionType: "+i.conditionType);return n.pass=!1,n}function getSelfUltimateData(i,e,t,a){var r=[];if(t)for(var n in a)for(var o in i)if(a[n]==i[o].chefId){for(var s in e)if(i[o].ultimateSkill==e[s].skillId){var f=[];for(var l in e[s].effect)"Self"==e[s].effect[l].condition&&f.push(e[s].effect[l]);if(f.length){var c={};c.chefId=i[o].chefId,c.effect=f,r.push(c)}break}break}return r}function getPartialChefAddsByIds(i,e,t,a){var r=[];if(t)for(var n in a)for(var o in i){var s=i[o];if(a[n]==s.chefId){for(var f in e){var l=e[f];if(s.ultimateSkill==l.skillId){for(var c in l.effect){var d=l.effect[c];"Partial"==d.condition&&isChefAddType(d.type)&&r.push(d)}break}}break}}return r}function getPartialChefAdds(i,e,t){for(var a=[],r=0;r<3;r++)a.push([]);for(var n in i){var o=i[n].chef;if(o.chefId&&t.calPartialChefIds.indexOf(o.chefId)>=0)for(var s in e){var f=e[s];if(o.ultimateSkill==f.skillId){for(var l in f.effect){var c=JSON.parse(JSON.stringify(f.effect[l]));if("Partial"==c.condition){if(isChefAddType(c.type)){var d=0;t.Satiety&&(d=Number(n));for(r=d;r<3;r++)a[r].push(c)}}else"Next"==c.condition&&Number(n)<2&&isChefAddType(c.type)&&a[Number(n)+1].push(c)}break}}}return a}function updateMaterialsData(i,e,t){for(var a in e.data.materials)for(var r in i)e.data.materials[a].material==i[r].materialId&&Number.isInteger(parseInt(i[r].quantity))&&(i[r].quantity-=e.data.materials[a].quantity*t)}function getMaxNSum(i,e){i.sort(function(i,e){return e.totalScore-i.totalScore});for(var t=0,a=Math.min(i.length,e),r=0;r<a;r++)t+=i[r].totalScore;return t}function getMaxNSumRecipes(i,e){var t=[];for(var a in i)for(var r in i[a].recipes)t.push(i[a].recipes[r]);t.sort(function(i,e){return e.totalScore-i.totalScore});var n=[],o=[],s=0;for(var f in t)if(o.indexOf(t[f].recipeId)<0&&(o.push(t[f].recipeId),n.push(t[f]),o.length<=e.rule.RecipesNumLimit&&(s+=t[f].totalScore),o.length==e.rule.ChefNumLimit*e.rule.RecipesNumLimit))break;return{recipes:n,sum:s}}